
DROP TABLE OrdersPartitioned PURGE;

DROP INDEX IDX_ORDERSPARTITIONED_CUSTOMER_ID;
DROP INDEX IDX_ORDERSPARTITIONED_EMPLOYEE_ID;
DROP INDEX IDX_ORDERSPARTITIONED_SHIPPER_ID;
DROP INDEX IDX_ORDERSPARTITIONED_ORDER_DATE;
DROP INDEX IDX_ORDERSPARTITIONED_SHIPPED_DATE;
DROP INDEX IDX_ORDERSPARTITIONED_SHIP_POSTAL_CODE;

ALTER TABLE OrdersPartitioned MODIFY OrderID NUMBER(9) GENERATED ALWAYS AS IDENTITY START WITH 1 INCREMENT BY 1;

CREATE TABLE OrdersPartitioned (
  OrderID NUMBER(9) GENERATED BY DEFAULT AS IDENTITY START WITH 1 INCREMENT BY 1,
  CustomerID VARCHAR2(5) NOT NULL,
  EmployeeID NUMBER(9) NOT NULL,
  OrderDate DATE NOT NULL,
  RequiredDate DATE,
  ShippedDate DATE,
  ShipVia NUMBER(9),
  Freight NUMBER(10,2) DEFAULT 0,
  ShipName VARCHAR2(40),
  ShipAddress VARCHAR2(60),
  ShipCity VARCHAR2(15),
  ShipRegion VARCHAR2(15),
  ShipPostalCode VARCHAR2(10),
  ShipCountry VARCHAR2(15),
  CONSTRAINT PK_OrdersPartitioned PRIMARY KEY (ShipCountry, OrderDate, OrderID),
  
  CONSTRAINT FK_OrdersPartitioned_Customers FOREIGN KEY (CustomerID) 
    REFERENCES Customers (Customer_ID),
  CONSTRAINT FK_OrdersPartitioned_Employees FOREIGN KEY (EmployeeID) 
    REFERENCES Employees (Employee_ID),
  CONSTRAINT FK_OrdersPartitioned_Shippers FOREIGN KEY (ShipVia) 
    REFERENCES Shippers (Shipper_ID)
)
PARTITION BY LIST (ShipCountry)
SUBPARTITION BY RANGE (OrderDate)
SUBPARTITION TEMPLATE (
  SUBPARTITION y1996 VALUES LESS THAN (DATE '1997-01-01'),
  SUBPARTITION y1997 VALUES LESS THAN (DATE '1998-01-01'),
  SUBPARTITION y1998 VALUES LESS THAN (DATE '1999-01-01'),
  SUBPARTITION y1999 VALUES LESS THAN (DATE '2000-01-01'),
  SUBPARTITION y2000 VALUES LESS THAN (DATE '2001-01-01'),
  SUBPARTITION y2001 VALUES LESS THAN (DATE '2002-01-01'),
  SUBPARTITION y2002 VALUES LESS THAN (DATE '2003-01-01'),
  SUBPARTITION y2003 VALUES LESS THAN (DATE '2004-01-01'),
  SUBPARTITION y2004 VALUES LESS THAN (DATE '2005-01-01'),
  SUBPARTITION y2005 VALUES LESS THAN (DATE '2006-01-01'),
  SUBPARTITION y2006 VALUES LESS THAN (DATE '2007-01-01'),
  SUBPARTITION y2007 VALUES LESS THAN (DATE '2008-01-01'),
  SUBPARTITION y2008 VALUES LESS THAN (DATE '2009-01-01'),
  SUBPARTITION y2009 VALUES LESS THAN (DATE '2010-01-01'),
  SUBPARTITION y2010 VALUES LESS THAN (DATE '2011-01-01'),
  SUBPARTITION y2011 VALUES LESS THAN (DATE '2012-01-01'),
  SUBPARTITION y2012 VALUES LESS THAN (DATE '2013-01-01'),
  SUBPARTITION y2013 VALUES LESS THAN (DATE '2014-01-01'),
  SUBPARTITION y2014 VALUES LESS THAN (DATE '2015-01-01'),
  SUBPARTITION y2015 VALUES LESS THAN (DATE '2016-01-01'),
  SUBPARTITION y2016 VALUES LESS THAN (DATE '2017-01-01'),
  SUBPARTITION y2017 VALUES LESS THAN (DATE '2018-01-01'),
  SUBPARTITION y2018 VALUES LESS THAN (DATE '2019-01-01'),
  SUBPARTITION y2019 VALUES LESS THAN (DATE '2020-01-01'),
  SUBPARTITION y2020 VALUES LESS THAN (DATE '2021-01-01'),
  SUBPARTITION y2021 VALUES LESS THAN (DATE '2022-01-01'),
  SUBPARTITION y2022 VALUES LESS THAN (DATE '2023-01-01'),
  SUBPARTITION y2023 VALUES LESS THAN (DATE '2024-01-01'),
  SUBPARTITION y2024 VALUES LESS THAN (DATE '2025-01-01'),
  SUBPARTITION y_max  VALUES LESS THAN (MAXVALUE)
)
(
  PARTITION p_argentina VALUES ('Argentina'),
  PARTITION p_australia VALUES ('Australia'),
  PARTITION p_austria VALUES ('Austria'),
  PARTITION p_belgium VALUES ('Belgium'),
  PARTITION p_brazil VALUES ('Brazil'),
  PARTITION p_canada VALUES ('Canada'),
  PARTITION p_denmark VALUES ('Denmark'),
  PARTITION p_finland VALUES ('Finland'),
  PARTITION p_france VALUES ('France'),
  PARTITION p_germany VALUES ('Germany'),
  PARTITION p_ireland VALUES ('Ireland'),
  PARTITION p_italy VALUES ('Italy'),
  PARTITION p_mexico VALUES ('Mexico'),
  PARTITION p_norway VALUES ('Norway'),
  PARTITION p_poland VALUES ('Poland'),
  PARTITION p_portugal VALUES ('Portugal'),
  PARTITION p_spain VALUES ('Spain'),
  PARTITION p_sweden VALUES ('Sweden'),
  PARTITION p_switzerland VALUES ('Switzerland'),
  PARTITION p_usa VALUES ('USA'),
  PARTITION p_venezuela VALUES ('Venezuela')
);


CREATE INDEX IDX_ORDERSPARTITIONED_CUSTOMER_ID       ON OrdersPartitioned(CustomerID);
CREATE INDEX IDX_ORDERSPARTITIONED_EMPLOYEE_ID       ON OrdersPartitioned(EmployeeID);
CREATE INDEX IDX_ORDERSPARTITIONED_SHIPPER_ID        ON OrdersPartitioned(ShipVia);
CREATE INDEX IDX_ORDERSPARTITIONED_ORDER_DATE        ON OrdersPartitioned(OrderDate);
CREATE INDEX IDX_ORDERSPARTITIONED_SHIPPED_DATE      ON OrdersPartitioned(ShippedDate);
CREATE INDEX IDX_ORDERSPARTITIONED_SHIP_POSTAL_CODE  ON OrdersPartitioned(ShipPostalCode);
